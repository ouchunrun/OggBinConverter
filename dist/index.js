(()=>{let e,t=document.getElementsByClassName("tip")[0],a=document.getElementById("fileUploadContent"),r=document.getElementById("fileConversion"),o=document.getElementsByClassName("fileIcon")[0],n=document.getElementsByClassName("fileName")[0],l=document.getElementsByClassName("console")[0],i=document.getElementById("consoleLog"),d=document.getElementById("uploadFile"),s=document.getElementById("selectButton"),c=document.getElementById("fileWitch"),m=document.getElementById("outputFormat"),u=document.querySelector("div.duration > input[type=range]"),w=document.getElementById("progress"),y=document.getElementById("audioFadeOut"),p=document.querySelector("div.duration"),k=document.getElementById("player");function _(t){t?(console.log("upload file: ",t.name),e=t,o.style.display="none",a.style.padding="0",r.style.display="block",n.innerText=t.name,l.style.display="block"):alert("file not found!")}function f(e,t){if(!e)return;let a=document.createElement("p");a.innerText=e,t&&(a.style.color=t),i.appendChild(a)}m.onchange=function(){console.log("set output format:",m.options[m.selectedIndex].value)},s.onclick=function(){console.log("Trigger the real file upload button"),d.click()},d.onchange=function(){_(this.files[0])},u.onchange=function(e){document.getElementsByClassName("durationShow")[0].textContent=parseInt(e.target.value)},c.onclick=function(){if(c.classList.contains("fileDownload"))document.getElementById("fileDownloadLink").click();else{a.style.display="none",c.style.opacity="0.6",c.disabled=!0,u.disabled=!0,y.disabled=!0,m.disabled=!0;let r=u.value;f("start file conversion ==> "+e.name),console.log("start file conversion: ",e.name),f("recorder duration "+r),console.log("audio fade out enabled ",y.checked),f("audio fade out enabled "+y.checked);let o=m.options[m.selectedIndex].value;console.log("outputFormat:",o),audioEncoder({file:e,duration:r,encoderType:o,audioFadeOut:y.checked,progressCallback:function(e){"recording"===e.state?w.style.width=Math.round(100*e.percent)+"%":"done"===e.state&&(w.style.width="100%",console.log("recorder complete!"),e.fileExceedsLimit&&(console.log("Due to file size limitations, the conversion time did not reach the recording duration."),f("Due to file size limitations, the conversion time did not reach the recording duration.")),f("Recorder complete!"))},doneCallBack:function(e,a){p.style.display="none",k.style.display="block",t.style.opacity="1",setTimeout((function(){t.style.opacity="0"}),5e3),f("recorder ondataavailable received!");let r=new Blob([a],{type:`audio/${o}`}),n=URL.createObjectURL(r);document.querySelector("#player > audio").src=n,console.warn("file size:",function(e){if(e<1024)return e+" B";if(e<1048576){let t=e/1024;return t=t.toFixed(2),t+" KB"}if(e<1073741824){let t=e/1048576;return t=t.toFixed(2),t+" MB"}{let t=e/1073741824;return t=t.toFixed(2),t+" GB"}}(e.size));let l=document.createElement("a");l.id="fileDownloadLink",l.href=n,l.download=e.name,l.style.display="none",l.innerHTML="<br>["+(new Date).toLocaleString()+"] "+e.name,k.appendChild(l),f("download link generated!"),c.classList.add("fileDownload"),c.innerText="Download",c.style.opacity="1",c.disabled=!1},errorCallBack:function(e){console.error(e.message),f("【Error】"+e.message,"red")}})}},a.addEventListener("drop",(function(e){this.style.borderColor="#288ef6",console.warn("dataTransfer file: ",e.dataTransfer.files[0]),_(e.dataTransfer.files[0])})),a.ondragover=function(e){e.preventDefault(),e.stopPropagation(),this.style.borderColor="#00bcd4"},a.ondragleave=function(){this.style.borderColor="#288ef6"},document.addEventListener("drop",(function(e){e.preventDefault()})),document.addEventListener("dragleave",(function(e){e.preventDefault()})),document.addEventListener("dragenter",(function(e){e.preventDefault()})),document.addEventListener("dragover",(function(e){e.preventDefault()})),window.onload=function(){!function(e){let t=Object.assign({watermark_txt:"water mark sample text",watermark_x:20,watermark_y:20,watermark_rows:1,watermark_cols:1,watermark_x_space:100,watermark_y_space:50,watermark_color:"#ddd",watermark_alpha:.4,watermark_fontsize:"125px",watermark_font:"微软雅黑",watermark_width:"100%",watermark_height:350,watermark_angle:20},{watermark_txt:"Grandstream"}),r=document.createDocumentFragment(),o=Math.max(document.body.scrollWidth,document.body.clientWidth,window.screen.availWidth);o-=.015*o;let n,l,i=Math.max(document.body.scrollHeight,document.body.clientHeight)+450;i=Math.max(i,window.innerHeight-30),(0===t.watermark_cols||parseInt(t.watermark_x+t.watermark_width*t.watermark_cols+t.watermark_x_space*(t.watermark_cols-1))>o)&&(t.watermark_cols=parseInt((o-t.watermark_x+t.watermark_x_space)/(t.watermark_width+t.watermark_x_space)),t.watermark_x_space=parseInt((o-t.watermark_x-t.watermark_width*t.watermark_cols)/(t.watermark_cols-1))),(0===t.watermark_rows||parseInt(t.watermark_y+t.watermark_height*t.watermark_rows+t.watermark_y_space*(t.watermark_rows-1))>i)&&(t.watermark_rows=parseInt((t.watermark_y_space+i-t.watermark_y)/(t.watermark_height+t.watermark_y_space)),t.watermark_y_space=parseInt((i-t.watermark_y-t.watermark_height*t.watermark_rows)/(t.watermark_rows-1)));for(let e=0;e<t.watermark_rows;e++){l=t.watermark_y+(t.watermark_y_space+t.watermark_height)*e;for(let a=0;a<t.watermark_cols;a++){n=t.watermark_x+(t.watermark_width+t.watermark_x_space)*a;let o=document.createElement("div");o.id="mask_div"+e+a,o.className="mask_div",o.appendChild(document.createTextNode(t.watermark_txt)),o.style.visibility="",o.style.position="absolute",o.style.overflow="hidden",o.style.zIndex="-1",o.style.pointerEvents="none",o.style.opacity=t.watermark_alpha,o.style.fontSize=t.watermark_fontsize,o.style.fontFamily=t.watermark_font,o.style.color=t.watermark_color,o.style.textAlign="center",o.style.width=t.watermark_width+"px",o.style.height=t.watermark_height+"px",o.style.display="block",o.style.top="0",o.style.left="0",o.style.right="0",o.style.bottom="0",o.style.margin="auto",o.style["line-height"]=t.watermark_height+"px",o.style["text-align"]="center",r.appendChild(o)}}a.appendChild(r)}()}})();