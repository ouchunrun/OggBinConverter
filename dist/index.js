(()=>{let e,t=document.getElementsByClassName("tip")[0],a=document.getElementById("fileUploadContent"),n=document.getElementById("fileConversion"),r=document.getElementsByClassName("fileIcon")[0],o=document.getElementsByClassName("fileName")[0],l=(document.getElementsByClassName("console")[0],document.getElementById("consoleLog")),i=document.getElementById("uploadFile"),d=document.getElementById("selectButton"),s=document.getElementById("fileWitch"),c=document.getElementById("grpModel"),m=document.getElementById("outputFormat"),u=document.querySelector("div.duration > input[type=range]"),w=document.getElementsByClassName("durationShow")[0],y=document.getElementById("progress"),p=document.getElementById("audioFadeOut"),k=document.querySelector("div.duration"),_=document.getElementById("player");function g(t){t?(console.log("upload file: ",t.name),e=t,r.style.display="none",a.style.padding="0",n.style.display="block",o.innerText=t.name):alert("file not found!")}function f(e,t){if(!e)return;let a=document.createElement("p");a.innerText=e,t&&(a.style.color=t),l.appendChild(a)}m.onchange=function(){let e=m.options[m.selectedIndex].value;switch(console.log("set output format:",e),e){case"ogg":u.value=30;break;case"bin":u.value=25}w.textContent=u.value},c.onchange=function(){switch(c.options[c.selectedIndex].value){case"ogg":m.options.selectedIndex=0,m.disabled=!0,u.value=30;break;case"bin":m.options.selectedIndex=1,m.disabled=!0,u.value=25;break;case"custom":m.options.selectedIndex=0,m.disabled=!1,u.value=30}w.textContent=u.value},d.onclick=function(){console.log("Trigger the real file upload button"),i.click()},i.onchange=function(){g(this.files[0])},u.onchange=function(e){w.textContent=e.target.value},s.onclick=function(){if(s.classList.contains("fileDownload"))document.getElementById("fileDownloadLink").click();else{a.style.display="none",s.style.opacity="0.6",s.disabled=!0,u.disabled=!0,p.disabled=!0,m.disabled=!0;let n=u.value;f("start file conversion ==> "+e.name),console.log("start file conversion: ",e.name),f("recorder duration "+n),console.log("audio fade out enabled ",p.checked),f("audio fade out enabled "+p.checked);let r=m.options[m.selectedIndex].value;console.log("outputFormat:",r),audioEncoder({file:e,duration:n,encoderType:r,audioFadeOut:p.checked,progressCallback:function(e){"recording"===e.state?y.style.width=Math.round(100*e.percent)+"%":"done"===e.state&&(y.style.width="100%",console.log("recorder complete!"),e.fileExceedsLimit&&(console.log("Due to file size limitations, the conversion time did not reach the recording duration."),f("Due to file size limitations, the conversion time did not reach the recording duration.")),f("Recorder complete!"))},doneCallBack:function(e,a){k.style.display="none",t.style.opacity="1",setTimeout((function(){t.style.opacity="0"}),5e3),f("recorder ondataavailable received!");let n=new Blob([a],{type:`audio/${r}`}),o=URL.createObjectURL(n);"bin"!==r&&(document.querySelector("#player > audio").src=o,_.style.display="block"),console.warn("file size:",function(e){if(e<1024)return e+" B";if(e<1048576){let t=e/1024;return t=t.toFixed(2),t+" KB"}if(e<1073741824){let t=e/1048576;return t=t.toFixed(2),t+" MB"}{let t=e/1073741824;return t=t.toFixed(2),t+" GB"}}(e.size));let l=document.createElement("a");l.id="fileDownloadLink",l.href=o,l.download=e.name,l.style.display="none",l.innerHTML="<br>["+(new Date).toLocaleString()+"] "+e.name,_.appendChild(l),f("download link generated!"),s.classList.add("fileDownload"),s.innerText="Download",s.style.opacity="1",s.disabled=!1},errorCallBack:function(e){console.error(e.message),f("【Error】"+e.message,"red")}})}},a.addEventListener("drop",(function(e){this.style.borderColor="#288ef6",console.warn("dataTransfer file: ",e.dataTransfer.files[0]),g(e.dataTransfer.files[0])})),a.ondragover=function(e){e.preventDefault(),e.stopPropagation(),this.style.borderColor="#00bcd4"},a.ondragleave=function(){this.style.borderColor="#288ef6"},document.addEventListener("drop",(function(e){e.preventDefault()})),document.addEventListener("dragleave",(function(e){e.preventDefault()})),document.addEventListener("dragenter",(function(e){e.preventDefault()})),document.addEventListener("dragover",(function(e){e.preventDefault()})),window.onload=function(){!function(e){let t=Object.assign({watermark_txt:"GRANDSTREAM",watermark_x:20,watermark_y:20,watermark_rows:1,watermark_cols:1,watermark_x_space:100,watermark_y_space:50,watermark_color:"#ddd",watermark_alpha:.4,watermark_fontsize:"125px",watermark_font:"BankGothicMdBTMedium",watermark_letter_spacing:"-17px",watermark_width:"100%",watermark_height:350,watermark_angle:20},{}),n=document.createDocumentFragment(),r=Math.max(document.body.scrollWidth,document.body.clientWidth,window.screen.availWidth);r-=.015*r;let o,l,i=Math.max(document.body.scrollHeight,document.body.clientHeight)+450;i=Math.max(i,window.innerHeight-30),(0===t.watermark_cols||parseInt(t.watermark_x+t.watermark_width*t.watermark_cols+t.watermark_x_space*(t.watermark_cols-1))>r)&&(t.watermark_cols=parseInt((r-t.watermark_x+t.watermark_x_space)/(t.watermark_width+t.watermark_x_space)),t.watermark_x_space=parseInt((r-t.watermark_x-t.watermark_width*t.watermark_cols)/(t.watermark_cols-1))),(0===t.watermark_rows||parseInt(t.watermark_y+t.watermark_height*t.watermark_rows+t.watermark_y_space*(t.watermark_rows-1))>i)&&(t.watermark_rows=parseInt((t.watermark_y_space+i-t.watermark_y)/(t.watermark_height+t.watermark_y_space)),t.watermark_y_space=parseInt((i-t.watermark_y-t.watermark_height*t.watermark_rows)/(t.watermark_rows-1)));for(let e=0;e<t.watermark_rows;e++){l=t.watermark_y+(t.watermark_y_space+t.watermark_height)*e;for(let a=0;a<t.watermark_cols;a++){o=t.watermark_x+(t.watermark_width+t.watermark_x_space)*a;let r=document.createElement("div");r.id="mask_div"+e+a,r.className="mask_div",r.appendChild(document.createTextNode(t.watermark_txt)),r.style.visibility="",r.style.position="absolute",r.style.overflow="hidden",r.style.zIndex="-1",r.style.pointerEvents="none",r.style.opacity=t.watermark_alpha,r.style.fontSize=t.watermark_fontsize,r.style.fontFamily=t.watermark_font,r.style.letterSpacing=t.watermark_letter_spacing,r.style.color=t.watermark_color,r.style.textAlign="center",r.style.width=t.watermark_width+"px",r.style.height=t.watermark_height+"px",r.style.display="block",r.style.top="0",r.style.left="0",r.style.right="0",r.style.bottom="0",r.style.margin="auto",r.style["line-height"]=t.watermark_height+"px",r.style["text-align"]="center",n.appendChild(r)}}a.appendChild(n)}()}})();