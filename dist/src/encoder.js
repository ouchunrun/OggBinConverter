function createRecorder(e){let r;e.encoderType=e.encoderType||"ogg";let o={encoderType:e.encoderType,desiredSampleRate:"ogg"===e.encoderType?16e3:8e3,workerPath:"ogg"===e.encoderType?"./toOgg/oggOpusEncoderWorker.js":"./toBin/encoderWorker.js",originalSampleRateOverride:e.desiredSampleRate};r=new Recorder(o,e);let t=e.file.name.replace(/\.[^\.]+$/,"");return["ring1","ring2","ring3","ring4","ring5","ring6","doorbell","silent"].includes(t)&&(t="cust_"+t),r.fileName=t,r.onstart=function(e){console.log("mediaRecorder is started")},r.onstop=function(e){console.log("mediaRecorder is stopped")},r.onpause=function(e){console.log("mediaRecorder is paused")},r.onresume=function(e){console.log("mediaRecorder is resuming")},r.ondataavailable=function(o){console.log("Data ondataavailable received");let t=new File([o],`${r.fileName}.${e.encoderType}`);r.recoderOptions.doneCallBack(t,o)},r}window.audioEncoder=function(e){let r=Recorder.getBrowserDetails();if(console.log("browserDetails : ",r),"ie"===r.browser||"edge"===r.browser||"safari"===r.browser||"chrome"===r.browser&&r.version<58||"opera"===r.browser&&r.chromeVersion<58||"firefox"===r.browser&&r.version<52)return void e.errorCallBack(Recorder.ERROR_MESSAGE.ERROR_CODE_1007);if(!Recorder.isRecordingSupported())return console.error("AudioContext or WebAssembly is not supported"),void(e&&e.errorCallBack&&(window.AudioContext?window.WebAssembly||e.errorCallBack(Recorder.ERROR_MESSAGE.ERROR_CODE_1003):e.errorCallBack(Recorder.ERROR_MESSAGE.ERROR_CODE_1002)));if(!e||!e.file||!e.doneCallBack)return console.warn(e),void e.errorCallBack(Recorder.ERROR_MESSAGE.ERROR_CODE_1001);let o,t=e.file;if(console.log("current upload file type "+t.type),!/audio\/\w+/.test(t.type))return void e.errorCallBack(Recorder.ERROR_MESSAGE.ERROR_CODE_1006);let n,a,c,i=new AudioContext,l=new FileReader;function d(){"recording"!==o.state&&"inactive"===o.state||(console.log("buffer source onEnded!"),o.stop(),n&&n.stop(),n=null,e.progressCallback({state:"done",percent:1}))}function s(r){try{let t=r.totalDuration;"stop"===r.state?(console.log("recorder.stop"),e.progressCallback({state:"done",percent:1,fileExceedsLimit:r.fileExceedsLimit}),o.stop(),n&&n.stop(),n=null):e.progressCallback({state:"recording",percent:t/c})}catch(r){e.errorCallBack(Recorder.ERROR_MESSAGE.ERROR_CODE_1009(r))}}try{l.onload=function(){i.decodeAudioData(this.result).then((function(r){r.duration<3?e.errorCallBack(Recorder.ERROR_MESSAGE.ERROR_CODE_1005):(console.log("upload file duration: "+r.duration+"(s)"),function(r){let t=i.createBufferSource();t.buffer=r,t.onended=d;let n=i.createMediaStreamDestination();c=Math.min(e.duration,r.duration),o.setRecordingDuration(c),t.connect(n),t.start(),a=i.createMediaStreamSource(n.stream),o.start(a,s)}(r))}),(function(e){console.warn("Error catch: ",e)}))},l.readAsArrayBuffer(t),o=createRecorder(e)}catch(r){e.errorCallBack(Recorder.ERROR_MESSAGE.ERROR_CODE_1009(r))}};